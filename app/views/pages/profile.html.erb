<div class="min-vh-100" style="background: rgb(48,46,46);
background: linear-gradient(166deg, rgba(48,46,46,1) 0%, rgba(0,0,0,1) 100%); color:white;">
  <div class="banner"></div>
  <div class="container">
    <div class="d-flex" data-controller="viewcountry">
      <%# left side %>
      <div class="col-3" style="align-items: center;
      display: flex;
      flex-direction: column;">
        <div class="avatar-bordered my-4"></div>
        <h4> Welcome! <%= current_user.username %></h4>
        <h5>Today's Country Spotlight!</h5>
        <hr style="color:white;">
        <div class="d-flex align-items-center ">
          <h5 style="padding:20px;"><%= @country[0].name %></h5>
          <%= image_tag "#{@country[0].flag_url}", style: "width: 60px;" %>
        </div>
        <div style="margin-right: 10px;">
          <div class="overflow-scroll country-window" style="height: 325px;" data-viewcountry-target="countryinput"><%= @countries_info %></div>
          <%= link_to "View articles for this Country", country_path(@country[0]), class: "pillbutton mt-3 w-100" %>
        </div>
      </div>
      <%# Right side %>
      <div class="flex-grow-1">
        <div class="my-3">
          <h4><strong>Countries Followed</strong></h4>
        </div>
        <div>
          <div class="country-articles">
            <% current_user.favorited_by_type('Country').each do |country| %>
              <div class="country-article" data-action="click->viewcountry#showinfo" style="position:static;">
                <div class="country-figure">
                  <%= image_tag "#{country.flag_url}", class: "country-article-image", style: "width:200px;" %>
                </div>
                <div class="country-article-body d-flex flex-column" style="padding:4px; color: black; align-items: center;">
                  <% carousel_id= country.name.gsub(/\s+/,"").downcase + "Carousel"%>
                  <h5>
                    <%= link_to country.name, country, style: "text-decoration: none; color:black;" %>
                    <%= render partial: "shared/heart_icon", locals: { country: country } %>
                  </h5>
                  <div id="<%=carousel_id%>" class="carousel slide " data-bs-ride="carousel">
                    <div class="carousel-inner">
                      <% country.articles.first(3).each do |article| %>
                        <div class="carousel-item <%= article == country.articles.first ? "active" : ""%>">
                          <div class="d-block w-100 card shadow-lg border-dark" style="border: none; height: 65px;">
                            <div class="card-body border-0">
                              <%= link_to article.title, article, class: "link-dark link-underline-opacity-0 card-text stretched-link", style: "margin-top: -18px;"%>
                            </div>
                          </div>
                        </div>
                      <% end %>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#<%=carousel_id%>" data-bs-slide="prev" style="z-index:0;">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#<%=carousel_id%>" data-bs-slide="next" style="z-index:0;">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                  </div>
                  <%= link_to "Read more articles", country_path(country), class: "h6", style: "text-decoration:none; color: black; padding: 2px 20px", class: "pillbutton" %>
                </div>
              </div>
            <% end %>
          </div>
          <hr>
        </div>
        <h4><strong>Topics Followed</strong></h4>
        <div class="d-flex" style="flex-direction:column;">
          <% current_user.favorited_by_type('Topic').each do |topic| %>
            <%= link_to topic_path(topic) do %>
              <div class="pillbutton">#<%= topic.name %></div>
            <% end %>
          <% end %>
        </div>
        <hr>
        <h4><strong>Articles Saved</strong></h4>
        <div class="d-flex" style="flex-direction:column;margin-bottom: 40px;">
          <% current_user.favorited_by_type('Article').order(:created_at).each_with_index do |article, index| %>
            <% article_id = article.title.gsub(/['Â¨]/,"").split(" ")[4] %>
            <button type="button" class="pillbutton text-truncate" style="-webkit-line-clamp: 4; max-width: 35ch;" data-bs-toggle="modal" data-bs-target="#exampleModal<%= article_id %>">
              <%= article.title %> <%= article.created_at.strftime("%b-%d-%Y") %>
            </button>
            <%# modal %>
            <div class="modal fade" id="exampleModal<%= article_id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="color:black;">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header" style="display:none;">
                    <h5 class="modal-title" id="exampleModalLabel" style="display:none;">Modal title</h5>
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body" style="padding:5px;">
                  <div class="article-background">
                    <div class="container container-md article p-5">
                      <%= image_tag article.image_url? ? article.image_url : image_path("TellUsBanner.jpg"),
            class: "img-thumbnail article-image" %>
                      <div class="d-flex align-items-center">
                        <h2 class="title mt-2 flex-grow-1"><%= article.title %></h2>
                        <%= render partial: "shared/like_article", locals: { article: article } %>
                      </div>
                      <button class="btn btn-success text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        Related topics
                      </button>
                      <div class="collapse" id="collapseExample">
                        <div class="card card-body circle">
                          <% article.topics.uniq.each do |topic| %>
                            <li class="list-inline-item">
                              <p><span class="badge">
                                  <%= link_to toggle_favorite_topic_path(topic), data: {"turbo-method": :patch} do %>
                                    <i data-toggle-heart-target="icon" data-action="click->toggle-heart#toggle" class="fa-solid fa-thumbtack <%= user_signed_in? && current_user.favorited?(topic) ? "" : "text-secondary" %>" style="color: #26630c;"></i>
                                  <% end %>
                                </span>
                                <span data-toggle-heart-target="newTopic"><%= link_to topic.name, topic, style: "color: black; text-decoration: none;" %></span></p>
                            </li>
                          <% end %>
                        </div>
                      </div>
                      <p class="content mt-3"><%= article.content %>.</p>
                      <%= link_to "Read the original article#{article.source.present? ? " at #{article.source}" : ""}", article.url, class: "btn btn-secondary rounded mt-2" %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
